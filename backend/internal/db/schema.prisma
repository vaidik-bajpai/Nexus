datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}
 
generator db {
    provider = "go run github.com/steebchen/prisma-client-go"
}
 
model User {
    id            String    @id @default(uuid())
    firstName     String?
    lastName      String?
    username      String?    
    email         String    @unique
    password      String?
    emailVerified DateTime?
    avatar        String?
    accessToken   String?
    refreshToken  String?
    createdAt     DateTime  @default(now())
    updatedAt     DateTime  @updatedAt
    
    token             Token[]
    accounts          Account[]
    workspaces        Workspace[]
    workspaceMember   WorkspaceMember[]
    
    @@index([email])
    @@map("users")
}

model Token {
    uID   String
    token String   @unique
    ttl   DateTime
    scope String
    user  User     @relation(fields: [uID], references: [id], onDelete: Cascade)

    @@unique([uID, scope])
    @@index([uID])
}

model Account {
    id                String   @id @default(uuid())
    userId            String
    type              String   // "oauth" or "credentials"
    provider          String   // "google", "github", "credentials", etc.
    providerAccountId String   // Provider's unique ID for this account
    
    user User @relation(fields: [userId], references: [id], onDelete: Cascade)
    
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    
    @@unique([provider, providerAccountId])
    @@index([userId])
    @@map("accounts")
}

model Workspace {
    id String @id @default(uuid())
    name String
    description String
    userId String
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now())
    user  User     @relation(fields: [userId], references: [id], onDelete: Cascade)
    workspaceMember   WorkspaceMember[]
    
    @@unique([name, userId])
}

model WorkspaceMember {
    id          String    @id @default(uuid())
    workspaceId String
    userId      String
    role        String    // admin, manager, member
    invitedAt   DateTime  @default(now())
    joinedAt    DateTime?
    createdAt   DateTime  @default(now())
    updatedAt   DateTime  @updatedAt

    workspace Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
    user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@unique([workspaceId, userId])
    @@index([workspaceId])
    @@index([userId])
    @@map("workspace_members")
}